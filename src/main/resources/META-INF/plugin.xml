<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.yelog.i18ntoolkit</id>
    <name>I18n Toolkit</name>
    <vendor url="https://github.com/yelog">yelog</vendor>

    <description><![CDATA[
    Intelligent i18n (internationalization) helper for JavaScript/TypeScript projects.
    <br><br>
    Features:
    <ul>
        <li>Auto-detect i18n frameworks: vue-i18n, react-i18next, i18next, next-intl, @nuxtjs/i18n, react-intl</li>
        <li>Inline translation preview at t() / $t() calls</li>
        <li>Cmd+Click navigation to translation files</li>
        <li>Find Usages for translation keys</li>
        <li>Cross-language navigation between locale files</li>
    </ul>
    ]]></description>

    <change-notes><![CDATA[
    <h3>0.0.4</h3>
    <h4>Fixed</h4>
    <ul>
        <li>In <code>Translation Only</code> display mode, translated folds are now re-collapsed immediately when the caret leaves the i18n key during Replace operations</li>
    </ul>
    <h4>Changed</h4>
    <ul>
        <li>Refactored translation cache refresh to use non-blocking read actions with refresh coalescing to reduce UI-thread work</li>
        <li>Improved Find Usages and reference search performance by scanning indexed source files instead of recursively traversing project directories</li>
        <li>Added cancellation checkpoints in cache build and usage scanning flows to keep the IDE responsive on large projects</li>
    </ul>

    <h3>0.0.3</h3>
    <h4>Fixed</h4>
    <ul>
        <li>Inline translation hints not displaying when files are reopened after being closed</li>
        <li>Inline translation hints not showing when IDEA starts with files already open (especially after long project loading times)</li>
        <li>Inline translation hints disappearing after switching away from IDEA for an extended period and returning</li>
        <li>Added intelligent cache clearing mechanism with 30-second threshold to avoid performance issues from frequent window switching</li>
    </ul>

    <h3>0.0.2</h3>
    <h4>Fixed</h4>
    <ul>
        <li>Navigation behavior: Cmd+Click on i18n function name (e.g., <code>t</code>) now preserves default behavior (jump to method declaration) instead of showing translation chooser</li>
        <li>Navigation now only triggers when clicking on the i18n key string or its quotes, not on the function name</li>
    </ul>
    <h4>Added</h4>
    <ul>
        <li>Translation search popup now remembers last search query and results when reopened</li>
        <li>Search query text is automatically selected for quick replacement when popup opens</li>
    </ul>

    <h3>0.0.1</h3>
    <ul>
        <li>Auto-detects popular i18n frameworks and scans multi-format locale files</li>
        <li>Smart key completion with display-language translation matching</li>
        <li>Inline translation preview, Quick Documentation, and translation search popup</li>
        <li>Go to Declaration/Implementation, cross-locale navigation, and Find Usages</li>
    </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>
    <depends>JavaScript</depends>
    <depends optional="true" config-file="i18n-java.xml">com.intellij.modules.java</depends>

    <resource-bundle>messages.I18nBundle</resource-bundle>

    <applicationListeners>
        <!-- Dynamic plugin loading listener - no restart required -->
        <listener class="com.github.yelog.i18ntoolkit.startup.I18nDynamicPluginListener"
                  topic="com.intellij.ide.plugins.DynamicPluginListener"/>
        <!-- Application activation listener - refreshes hints when returning to IDEA -->
        <listener class="com.github.yelog.i18ntoolkit.listener.I18nApplicationActivationListener"
                  topic="com.intellij.openapi.application.ApplicationActivationListener"/>
    </applicationListeners>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Project Service for caching translations -->
        <projectService serviceImplementation="com.github.yelog.i18ntoolkit.service.I18nCacheService"/>

        <!-- Startup activity to initialize cache -->
        <postStartupActivity implementation="com.github.yelog.i18ntoolkit.startup.I18nProjectActivity"/>
        <postStartupActivity implementation="com.github.yelog.i18ntoolkit.listener.I18nDocumentListenerRegistrar"/>

        <!-- Goto declaration handler for Cmd+Click on folded regions -->
        <gotoDeclarationHandler implementation="com.github.yelog.i18ntoolkit.navigation.I18nGotoDeclarationHandler" order="first"/>

        <!-- Goto implementation support for i18n keys -->
        <definitionsScopedSearch implementation="com.github.yelog.i18ntoolkit.navigation.I18nDefinitionsScopedSearchExecutor"/>
        <targetElementEvaluator language="JavaScript"
                                implementationClass="com.github.yelog.i18ntoolkit.navigation.I18nTargetElementEvaluator"/>
        <targetElementEvaluator language="TypeScript"
                                implementationClass="com.github.yelog.i18ntoolkit.navigation.I18nTargetElementEvaluator"/>
        <targetElementEvaluator language="Vue"
                                implementationClass="com.github.yelog.i18ntoolkit.navigation.I18nTargetElementEvaluator"/>
        <targetElementEvaluator language="TypeScript JSX"
                                implementationClass="com.github.yelog.i18ntoolkit.navigation.I18nTargetElementEvaluator"/>

        <!-- Documentation provider for Quick Definition/Documentation on i18n keys -->
        <lang.documentationProvider language="JSON"
                                    implementationClass="com.github.yelog.i18ntoolkit.documentation.I18nDocumentationProvider"
                                    order="first"/>
        <lang.documentationProvider language="JavaScript"
                                    implementationClass="com.github.yelog.i18ntoolkit.documentation.I18nDocumentationProvider"
                                    order="first"/>
        <lang.documentationProvider language="TypeScript"
                                    implementationClass="com.github.yelog.i18ntoolkit.documentation.I18nDocumentationProvider"
                                    order="first"/>
        <lang.documentationProvider language="Vue"
                                    implementationClass="com.github.yelog.i18ntoolkit.documentation.I18nDocumentationProvider"
                                    order="first"/>
        <lang.documentationProvider language="TypeScript JSX"
                                    implementationClass="com.github.yelog.i18ntoolkit.documentation.I18nDocumentationProvider"
                                    order="first"/>

        <!-- Inlay hints for showing translations inline -->
        <codeInsight.inlayProvider language="JavaScript"
                                   implementationClass="com.github.yelog.i18ntoolkit.hint.I18nInlayHintsProvider"/>
        <codeInsight.inlayProvider language="TypeScript"
                                   implementationClass="com.github.yelog.i18ntoolkit.hint.I18nInlayHintsProvider"/>
        <codeInsight.inlayProvider language="Vue"
                                   implementationClass="com.github.yelog.i18ntoolkit.hint.I18nInlayHintsProvider"/>
        <codeInsight.inlayProvider language="TypeScript JSX"
                                   implementationClass="com.github.yelog.i18ntoolkit.hint.I18nInlayHintsProvider"/>

        <!-- Annotator for highlighting missing i18n keys -->
        <annotator language="JavaScript"
                   implementationClass="com.github.yelog.i18ntoolkit.annotator.I18nKeyAnnotator"/>
        <annotator language="TypeScript"
                   implementationClass="com.github.yelog.i18ntoolkit.annotator.I18nKeyAnnotator"/>
        <annotator language="Vue"
                   implementationClass="com.github.yelog.i18ntoolkit.annotator.I18nKeyAnnotator"/>
        <annotator language="TypeScript JSX"
                   implementationClass="com.github.yelog.i18ntoolkit.annotator.I18nKeyAnnotator"/>

        <!-- Completion for i18n keys -->
        <completion.contributor language="JavaScript"
                                implementationClass="com.github.yelog.i18ntoolkit.completion.I18nKeyCompletionContributor"/>
        <completion.contributor language="TypeScript"
                                implementationClass="com.github.yelog.i18ntoolkit.completion.I18nKeyCompletionContributor"/>
        <completion.contributor language="Vue"
                                implementationClass="com.github.yelog.i18ntoolkit.completion.I18nKeyCompletionContributor"/>
        <completion.contributor language="TypeScript JSX"
                                implementationClass="com.github.yelog.i18ntoolkit.completion.I18nKeyCompletionContributor"/>

        <!-- Reference contributor for Cmd+Click navigation -->
        <psi.referenceContributor language="JavaScript"
                                  implementation="com.github.yelog.i18ntoolkit.reference.I18nReferenceContributor"/>
        <psi.referenceContributor language="TypeScript"
                                  implementation="com.github.yelog.i18ntoolkit.reference.I18nReferenceContributor"/>
        <psi.referenceContributor language="Vue"
                                  implementation="com.github.yelog.i18ntoolkit.reference.I18nReferenceContributor"/>
        <psi.referenceContributor language="TypeScript JSX"
                                  implementation="com.github.yelog.i18ntoolkit.reference.I18nReferenceContributor"/>
        
        <!-- Line marker for cross-language navigation in translation files -->
        <codeInsight.lineMarkerProvider language="JSON"
                                        implementationClass="com.github.yelog.i18ntoolkit.marker.I18nLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="yaml"
                                        implementationClass="com.github.yelog.i18ntoolkit.marker.I18nLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="JavaScript"
                                        implementationClass="com.github.yelog.i18ntoolkit.marker.I18nLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="TypeScript"
                                        implementationClass="com.github.yelog.i18ntoolkit.marker.I18nLineMarkerProvider"/>

        <lang.foldingBuilder language="JavaScript"
                             implementationClass="com.github.yelog.i18ntoolkit.folding.I18nFoldingBuilder"/>
        <lang.foldingBuilder language="TypeScript"
                             implementationClass="com.github.yelog.i18ntoolkit.folding.I18nFoldingBuilder"/>
        <lang.foldingBuilder language="Vue"
                             implementationClass="com.github.yelog.i18ntoolkit.folding.I18nFoldingBuilder"/>
        <lang.foldingBuilder language="TypeScript JSX"
                             implementationClass="com.github.yelog.i18ntoolkit.folding.I18nFoldingBuilder"/>

        <projectConfigurable id="i18n.toolkit.settings"
                             displayName="I18n Toolkit"
                             instance="com.github.yelog.i18ntoolkit.settings.I18nSettingsConfigurable"
                             nonDefaultProject="true"/>
        
        <!-- File listener for cache invalidation -->
        <vfs.asyncListener implementation="com.github.yelog.i18ntoolkit.listener.I18nFileListener"/>

        <!-- Find Usages support for i18n keys in translation files -->
        <referencesSearch implementation="com.github.yelog.i18ntoolkit.reference.I18nUsageSearcher"/>
        <findUsagesHandlerFactory implementation="com.github.yelog.i18ntoolkit.usages.I18nFindUsagesHandlerFactory"
                                  order="first"/>
        <renamePsiElementProcessor implementation="com.github.yelog.i18ntoolkit.rename.I18nKeyRenameProcessor"/>

        <!-- Search Everywhere tab for i18n translations -->
        <searchEverywhereContributor implementation="com.github.yelog.i18ntoolkit.searcheverywhere.I18nSearchEverywhereContributorFactory"/>

        <!-- Status bar widget for i18n display language -->
        <statusBarWidgetFactory id="I18nDisplayLanguage" implementation="com.github.yelog.i18ntoolkit.statusbar.I18nStatusBarWidgetFactory" order="before memoryIndicator"/>
        <notificationGroup id="I18n Toolkit" displayType="BALLOON"/>
    </extensions>

    <actions>
        <action id="I18nToolkit.ShowTranslationsPopup"
                class="com.github.yelog.i18ntoolkit.action.I18nTranslationsPopupAction"
                text="Show I18n Translations"
                description="Show translations for current i18n key">
            <keyboard-shortcut keymap="Mac OS X" first-keystroke="meta shift I"/>
            <keyboard-shortcut keymap="Mac OS X 10.5+" first-keystroke="meta shift I"/>
            <keyboard-shortcut keymap="$default" first-keystroke="control shift I"/>
        </action>
    </actions>
</idea-plugin>
